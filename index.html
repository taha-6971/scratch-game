<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø¨Ø§Ø²ÛŒ Ø§Ø³Ú©Ø±Ú†</title>
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#18181b" />
  <style>
    html, body { height: 100%; margin: 0; background:#0b0b0f; color:#fff; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    .wrap { display:flex; flex-direction:column; height:100%; }
    header { padding: 12px 16px; display:flex; align-items:center; gap:12px; }
    header img { width:28px; height:28px; border-radius:8px; }
    header h1 { font-size: 16px; margin:0; font-weight:600; }
    .info { font-size: 13px; opacity: .8; padding: 0 16px 10px; }
    iframe { flex:1; width:100%; border:0; background:#000; }
  </style>
  <script>
    // Ø«Ø¨Øª Service Worker Ø¨Ø±Ø§ÛŒ Ù†ØµØ¨ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† ÙˆØ¨â€ŒØ§Ù¾
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js');
      });
    }
  </script>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="./icons/icon-192.png" alt="icon">
      <h1>ğŸ® Ø¨Ø§Ø²ÛŒ Ø§Ø³Ú©Ø±Ú†</h1>
    </header>
    <div class="info">
      Ø§Ú¯Ø± Ø¨Ø§Ø²ÛŒ Ø§Ø¬Ø±Ø§ Ù†Ø´Ø¯ØŒ Ù…Ø·Ù…Ø¦Ù† Ø´Ùˆ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø±Ø§ Ø±ÙˆÛŒ GitHub Pages ÛŒØ§ Netlify Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒ.
    </div>
    <iframe id="player" allow="autoplay; fullscreen" allowfullscreen></iframe>
  </div>

  <script>
    const iframe = document.getElementById('player');

    async function loadGame() {
      try {
        // Ø¯Ø±ÛŒØ§ÙØª ÙØ§ÛŒÙ„ sb3 Ø§Ø² Ø³Ø±ÙˆØ± Ø®ÙˆØ¯Øª (Ø¨Ø¯ÙˆÙ† Ø®Ø·Ø§ÛŒ CORS)
        const resp = await fetch('./game.sb3');
        const blob = await resp.blob();

        // ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Data URL
        const dataURL = await new Promise((resolve) => {
          const reader = new FileReader();
          reader.onloadend = () => resolve(reader.result);
          reader.readAsDataURL(blob);
        });

        // Ø³Ø§Ø®Øª Ù„ÛŒÙ†Ú© TurboWarp Ø¨Ø§ Ø¯Ø§Ø¯Ù‡â€ŒÛŒ Ø¯Ø§Ø®Ù„ÛŒ
        const embedUrl =
          'https://turbowarp.org/embed.html#' +
          'project_url=' + encodeURIComponent(dataURL) +
          '&autoplay&fps=60&turbo';

        iframe.src = embedUrl;
      } catch (e) {
        console.error('Ø®Ø·Ø§ Ø¯Ø± Ù„ÙˆØ¯ Ø¨Ø§Ø²ÛŒ:', e);
        iframe.outerHTML = '<p style="padding:16px;color:red;">Ø®Ø·Ø§ÛŒÛŒ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ø§Ø²ÛŒ Ø±Ø® Ø¯Ø§Ø¯. Ù„Ø·ÙØ§Ù‹ ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†.</p>';
      }
    }

    loadGame();
  </script>
</body>
</html>
